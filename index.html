<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Earn & Reward App</title>
    <!-- Fonts + Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
    <style>
        /* আগের CSS সব অপরিবর্তিত থাকবে */
    </style>
</head>
<body>
    <div id="app">
        <!-- Profile Header -->
        <header class="profile-header">
            <div class="profile-info">
                <img id="user-photo" src="" alt="User Photo">
                <div class="user-details">
                    <h1 id="user-name">Loading... <i class="fas fa-check-circle verified-icon"></i></h1>
                    <p> Balance: ৳<span id="user-points">0</span>TK</p>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main id="main-content">
            <!-- Dashboard, Tasks, Withdraw Sections (আগের মতই) -->
        </main>

        <!-- Bottom Nav -->
        <nav class="bottom-nav">
            <button class="nav-btn active" data-page="home-page"><i class="fas fa-home"></i><span>Home</span></button>
            <button class="nav-btn" data-page="tasks-page"><i class="fas fa-tasks"></i><span>Tasks</span></button>
            <button class="nav-btn" data-page="withdraw-page"><i class="fas fa-wallet"></i><span>Withdraw</span></button>
        </nav>
    </div>

    <!-- Loading Modal -->
    <div id="loading-modal" class="modal">
        <div class="modal-content"><div class="loader"></div><p>Loading Ad...</p></div>
    </div>
    
    <!-- Telegram SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- Ads SDK -->
    <script src='//libtl.com/sdk.js' data-zone='9712189' data-sdk='show_9712189'></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const tg = window.Telegram.WebApp;

            // --- Telegram Bot Config ---
            const BOT_TOKEN = "8264335895:AAE3ZtLWbrFci6ewwewFeahGhFxi7WwFkTQ"; 
            const BOT_USERNAME = "ttamo_bot"; // আপনার বট username
            const ADMIN_CHAT_ID = "7109891636"; // আপনার Telegram ID
            const CHANNEL_LINK = "https://t.me/trickmimicrojob";
            const GROUP_LINK = "https://t.me/+XOFG-KodIfkzMDc1";

            // --- Firebase Config ---
            const firebaseConfig = {
                apiKey: "AIzaSyB2UyrZZ5yu9N4EJLELXBkcLRYe6OA4IJM",
                authDomain: "tta-mo.firebaseapp.com",
                projectId: "tta-mo",
                storageBucket: "tta-mo.firebasestorage.app",
                messagingSenderId: "768846766181",
                appId: "1:768846766181:web:a2c2af74b6e3c087b4268c"
            };

            // Initialize Firebase
            const app = firebase.initializeApp(firebaseConfig);
            const db = firebase.firestore(app);
            const auth = firebase.auth(app);

            // --- Core Settings ---
            const DAILY_AD_LIMIT = 25;
            const POINTS_PER_AD = 0.25;
            const CHANNEL_JOIN_BONUS = 10;
            const GROUP_JOIN_BONUS = 2;
            const MIN_WITHDRAW_POINTS = 50;

            // --- State ---
            let userState = {
                points: 0,
                dailyAdWatchCount: 0,
                lastAdWatchDate: null,
                referrals: [],
                hasJoinedChannel: false,
                hasJoinedGroup: false,
                userId: null
            };

            // --- Functions (initApp, updateUI, handleWithdraw etc. আগের মতই থাকবে, শুধু BOT_TOKEN, BOT_USERNAME, Firebase add হয়েছে) ---

            const saveState = () => {
                if(userState.userId){
                    localStorage.setItem(`userState_${userState.userId}`, JSON.stringify(userState));
                }
            };

            const loadState = (userId) => {
                const savedState = localStorage.getItem(`userState_${userId}`);
                if(savedState) {
                    userState = JSON.parse(savedState);
                }
            };

            const initApp = () => {
                tg.ready();
                tg.expand();
                document.body.className = `${tg.colorScheme}-theme`;

                const user = tg.initDataUnsafe.user;
                if(!user || !user.id){
                    tg.showAlert("Please open via Telegram.", () => tg.close());
                    return;
                }

                userState.userId = user.id;
                loadState(user.id);

                const today = new Date().toISOString().slice(0, 10);
                if(userState.lastAdWatchDate !== today){
                    userState.dailyAdWatchCount = 0;
                    userState.lastAdWatchDate = today;
                }

                updateUI();
                setupNavigation();
                setupEventListeners();
                saveState();
            };

            const updateUI = () => {
                const user = tg.initDataUnsafe.user;
                if(user){
                    document.getElementById('user-photo').src = user.photo_url || 'https://i.imgur.com/placeholder.png';
                    document.getElementById('user-name').innerHTML = `${user.first_name || ''} ${user.last_name || ''} <i class="fas fa-check-circle verified-icon"></i>`;
                }
                document.getElementById('user-points').textContent = userState.points;
                document.getElementById('daily-ads-watched').textContent = userState.dailyAdWatchCount;
                document.getElementById('referral-count').textContent = userState.referrals.length;

                document.getElementById('referral-link').value = `https://t.me/${BOT_USERNAME}?start=ref_${userState.userId}`;
            };

            initApp();
        });
    </script>
</body>
</html>
